import { Component, ViewChild, forwardRef, Attribute, Input, Output, EventEmitter, Inject, PLATFORM_ID, SecurityContext } from '@angular/core';
import { NG_VALUE_ACCESSOR, NG_VALIDATORS } from '@angular/forms';
import { isPlatformBrowser } from '@angular/common';
import * as i0 from "@angular/core";
import * as i1 from "@angular/platform-browser";
import * as i2 from "./resize-sensor/resize-sensor.component";
import * as i3 from "@angular/common";
const DEFAULT_EDITOR_OPTION = {
    showPreviewPanel: true,
    showBorder: true,
    hideIcons: [],
    usingFontAwesome5: false,
    scrollPastEnd: 0,
    enablePreviewContentClick: false,
    resizable: false
};
export class MarkdownEditorComponent {
    constructor(platform, required = false, maxlength = -1, _ngZone, _renderer2, _domSanitizer) {
        this.platform = platform;
        this.required = required;
        this.maxlength = maxlength;
        this._ngZone = _ngZone;
        this._renderer2 = _renderer2;
        this._domSanitizer = _domSanitizer;
        this.hideToolbar = false;
        this.height = "300px";
        this._mode = 'editor';
        this._options = {};
        this.onEditorLoaded = new EventEmitter();
        this.onPreviewDomChanged = new EventEmitter();
        this.hideIcons = {};
        this.showPreviewPanel = true;
        this.isFullScreen = false;
        this.dragover = false;
        this.isUploading = false;
        this._onChange = (_) => { };
        this._onTouched = () => { };
    }
    get mode() {
        return this._mode;
    }
    set mode(value) {
        this._mode = (!value || ['editor', 'preview'].indexOf(value.toLowerCase()) === -1)
            ? 'editor'
            : value;
        setTimeout(() => {
            if (this._aceEditorIns && typeof this._aceEditorIns.resize === 'function') {
                this._aceEditorIns.resize();
            }
        }, 100);
    }
    get options() {
        return this._options || {};
    }
    set options(value) {
        let _options = Object.assign(DEFAULT_EDITOR_OPTION, {}, value);
        let _hideIcons = {};
        if (typeof _options.showPreviewPanel === 'boolean') {
            this.showPreviewPanel = _options.showPreviewPanel;
        }
        if (Array.isArray(_options.hideIcons)) {
            _options.hideIcons.forEach((v) => {
                if (v === 'Refrence')
                    v = 'Reference';
                _hideIcons[v] = true;
            });
        }
        this._options = _options;
        this.hideIcons = _hideIcons;
    }
    //#region Markdown value and html value define
    get markdownValue() {
        return this._markdownValue || '';
    }
    get _hasUploadFunction() {
        return this.upload && this.upload instanceof Function;
    }
    get _isInBrowser() {
        return isPlatformBrowser(this.platform);
    }
    ngOnInit() {
        if (!this._isInBrowser)
            return;
        let markedRender = new marked.Renderer();
        markedRender.image = this._getRender('image');
        markedRender.code = this._getRender('code');
        markedRender.table = this._getRender('table');
        markedRender.listitem = this._getRender('listitem');
        let markedjsOpt = {
            renderer: markedRender,
            highlight: (code) => hljs.highlightAuto(code).value
        };
        this._markedJsOpt = Object.assign({}, markedjsOpt, this.options.markedjsOpt);
        if (this._markedJsOpt.sanitize === true && typeof this._markedJsOpt.sanitizer !== 'function') {
            this._markedJsOpt.sanitizer = (markdownString) => {
                return this._domSanitizer.sanitize(SecurityContext.HTML, markdownString);
            };
        }
    }
    ngAfterViewInit() {
        if (!this._isInBrowser)
            return;
        let editorElement = this.aceEditorContainer.nativeElement;
        let editor = ace.edit(editorElement);
        editor.$blockScrolling = Infinity;
        editor.getSession().setUseWrapMode(true);
        editor.getSession().setMode("ace/mode/markdown");
        editor.setValue(this.markdownValue, 1);
        editor.setOption('scrollPastEnd', this._options.scrollPastEnd || 0);
        editor.on('change', (e) => {
            if (this._isValueSettedByprogrammatically)
                return;
            let val = editor.getValue();
            this._updateMarkdownValue(val, true);
            this._onChange(this.markdownValue);
        });
        editor.on('blur', () => { this._onTouched(); });
        this.onEditorLoaded.next(editor);
        this._aceEditorIns = editor;
    }
    ngOnDestroy() {
        this._aceEditorIns && this._aceEditorIns.destroy();
    }
    writeValue(value) {
        this._updateMarkdownValue(value, false);
    }
    registerOnChange(fn) {
        this._onChange = fn;
    }
    registerOnTouched(fn) {
        this._onTouched = fn;
    }
    validate(c) {
        let result = null;
        if (this.required && this.markdownValue.length === 0) {
            result = { required: true };
        }
        if (this.maxlength > 0 && this.markdownValue.length > this.maxlength) {
            result = { maxlength: true };
        }
        return result;
    }
    insertContent(type, customContent) {
        if (!this._aceEditorIns)
            return;
        let selectedText = this._aceEditorIns.getSelectedText();
        let isSelected = !!selectedText;
        let startSize = 2;
        let initText = '';
        let range = this._aceEditorIns.selection.getRange();
        switch (type) {
            case 'Bold':
                initText = 'Bold Text';
                selectedText = `**${selectedText || initText}**`;
                break;
            case 'Italic':
                initText = 'Italic Text';
                selectedText = `*${selectedText || initText}*`;
                startSize = 1;
                break;
            case 'Heading':
                initText = 'Heading';
                selectedText = `# ${selectedText || initText}`;
                break;
            case 'Reference':
                initText = 'Reference';
                selectedText = `> ${selectedText || initText}`;
                break;
            case 'Link':
                selectedText = `[](http://)`;
                startSize = 1;
                break;
            case 'Image':
                selectedText = `![](http://)`;
                break;
            case 'Ul':
                selectedText = `- ${selectedText || initText}`;
                break;
            case 'Ol':
                selectedText = `1. ${selectedText || initText}`;
                startSize = 3;
                break;
            case 'Code':
                initText = 'Source Code';
                selectedText = "```language\r\n" + (selectedText || initText) + "\r\n```";
                startSize = 3;
                break;
            case 'Custom':
                selectedText = customContent;
                startSize = 0;
                break;
        }
        this._aceEditorIns.session.replace(range, selectedText);
        if (!isSelected) {
            range.start.column += startSize;
            range.end.column = range.start.column + initText.length;
            this._aceEditorIns.selection.setRange(range);
        }
        this._aceEditorIns.focus();
    }
    togglePreview() {
        this.showPreviewPanel = !this.showPreviewPanel;
        this.editorResize();
    }
    previewPanelClick(event) {
        if (this.options.enablePreviewContentClick !== true) {
            event.preventDefault();
            event.stopImmediatePropagation();
        }
    }
    fullScreen() {
        this.isFullScreen = !this.isFullScreen;
        this._renderer2.setStyle(document.body, 'overflowY', this.isFullScreen ? 'hidden' : 'auto');
        this.editorResize();
    }
    mdEditorResize(size) {
        this.editorResize();
    }
    editorResize(timeOut = 100) {
        if (!this._aceEditorIns)
            return;
        if (this._aceEditorResizeTimer)
            clearTimeout(this._aceEditorResizeTimer);
        this._aceEditorResizeTimer = setTimeout(() => {
            this._aceEditorIns.resize();
            this._aceEditorIns.focus();
        }, timeOut);
    }
    onDragover(evt) {
        evt.stopImmediatePropagation();
        evt.preventDefault();
        if (!this._hasUploadFunction)
            return;
        this.dragover = true;
    }
    onDrop(evt) {
        evt.stopImmediatePropagation();
        evt.preventDefault();
        this._uploadFiles(evt.dataTransfer.files);
    }
    onDragleave(evt) {
        evt.stopImmediatePropagation();
        evt.preventDefault();
        if (!this._hasUploadFunction)
            return;
        this.dragover = false;
    }
    onAceEditorPaste(event) {
        if (event instanceof ClipboardEvent && event.clipboardData.files.length > 0) {
            this._uploadFiles(event.clipboardData.files);
        }
    }
    _updateMarkdownValue(value, changedByUser = false) {
        const normalizedValue = typeof value === 'string' ? value : (value || '').toString();
        if (this._markdownValue === normalizedValue)
            return;
        this._markdownValue = normalizedValue;
        this._updateDom();
        if (this._aceEditorIns && !changedByUser) {
            this._isValueSettedByprogrammatically = true;
            this._aceEditorIns.setValue(normalizedValue, 1);
            this._isValueSettedByprogrammatically = false;
        }
    }
    _updateDom() {
        if (this._convertMarkdownToHtmlTimer)
            clearTimeout(this._convertMarkdownToHtmlTimer);
        this._convertMarkdownToHtmlTimer = setTimeout(() => {
            Promise.resolve(this.markdownValue)
                .then((mdContent) => {
                return (this.preRender && this.preRender instanceof Function) ? this.preRender(mdContent) : mdContent;
            })
                .then(mdContent => {
                let html = marked(mdContent || '', this._markedJsOpt);
                return (this.postRender && this.postRender instanceof Function) ? this.postRender(html) : html;
            })
                .then(parsedHtml => {
                this.previewHtml = this._domSanitizer.bypassSecurityTrustHtml(parsedHtml);
                if (this.previewContainer && this.previewContainer.nativeElement) {
                    this._ngZone.runOutsideAngular(() => {
                        this._renderer2.setProperty(this.previewContainer.nativeElement, 'innerHTML', parsedHtml);
                        setTimeout(() => { this.onPreviewDomChanged.next(this.previewContainer.nativeElement); }, 100);
                    });
                }
            })
                .catch(err => {
                console.error(err);
            });
        }, 100);
    }
    _getRender(renderType) {
        let customRender = this.options && this.options.customRender && this.options.customRender[renderType];
        if (customRender && typeof customRender === 'function') {
            return customRender;
        }
        else {
            switch (renderType) {
                case 'image':
                    return function (href, title, text) {
                        let out = `<img style="max-width: 100%;" src="${href}" alt="${text}"`;
                        if (title) {
                            out += ` title="${title}"`;
                        }
                        out += this.options.xhtml ? "/>" : ">";
                        return out;
                    };
                case 'code':
                    return function (code, language) {
                        let validLang = !!(language && hljs.getLanguage(language));
                        let highlighted = '';
                        if (validLang) {
                            highlighted = hljs.highlight(language, code).value;
                        }
                        else {
                            let pre = document.createElement('pre');
                            pre.innerText = code;
                            highlighted = pre.innerHTML;
                        }
                        return `<pre style="padding: 0; border-radius: 0;"><code class="hljs ${language}">${highlighted}</code></pre>`;
                    };
                case 'table':
                    return function (header, body) {
                        return `<table class="table table-bordered">\n<thead>\n${header}</thead>\n<tbody>\n${body}</tbody>\n</table>\n`;
                    };
                case 'listitem':
                    return function (text, task, checked) {
                        if (/^\s*\[[x ]\]\s*/.test(text) || text.startsWith('<input')) {
                            if (text.startsWith('<input')) {
                                text = text
                                    .replace('<input disabled="" type="checkbox">', '<i class="fa fa-square-o"></i>')
                                    .replace('<input checked="" disabled="" type="checkbox">', '<i class="fa fa-check-square"></i>');
                            }
                            else {
                                text = text
                                    .replace(/^\s*\[ \]\s*/, '<i class="fa fa-square-o"></i> ')
                                    .replace(/^\s*\[x\]\s*/, '<i class="fa fa-check-square"></i> ');
                            }
                            return `<li>${text}</li>`;
                        }
                        else {
                            return `<li>${text}</li>`;
                        }
                    };
            }
        }
    }
    _uploadFiles(files) {
        if (!this._hasUploadFunction || this.isUploading)
            return;
        if (!files || files.length === 0) {
            this.dragover = false;
            return;
        }
        this.isUploading = true;
        // force dragover to be true, as Uploading mask won't work otherwise
        this.dragover = true;
        Promise.resolve()
            .then(() => {
            return this.upload(files);
        })
            .then(data => {
            if (Array.isArray(data)) {
                let msg = [];
                for (let item of data) {
                    let tempMsg = `[${item.name}](${item.url})`;
                    if (item.isImg) {
                        tempMsg = `!${tempMsg}`;
                    }
                    msg.push(tempMsg);
                }
                this.insertContent('Custom', msg.join('\r\n'));
            }
            else {
                console.warn('Invalid upload result. Please using follow this type `UploadResult`.');
            }
            this.isUploading = false;
            this.dragover = false;
        })
            .catch(err => {
            console.error(err);
            this.isUploading = false;
            this.dragover = false;
        });
    }
}
MarkdownEditorComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: MarkdownEditorComponent, deps: [{ token: PLATFORM_ID }, { token: 'required', attribute: true }, { token: 'maxlength', attribute: true }, { token: i0.NgZone }, { token: i0.Renderer2 }, { token: i1.DomSanitizer }], target: i0.ɵɵFactoryTarget.Component });
MarkdownEditorComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.1.1", type: MarkdownEditorComponent, selector: "md-editor", inputs: { hideToolbar: "hideToolbar", height: "height", preRender: "preRender", postRender: "postRender", upload: "upload", mode: "mode", options: "options" }, outputs: { onEditorLoaded: "onEditorLoaded", onPreviewDomChanged: "onPreviewDomChanged" }, providers: [
        {
            provide: NG_VALUE_ACCESSOR,
            useExisting: forwardRef(() => MarkdownEditorComponent),
            multi: true
        },
        {
            provide: NG_VALIDATORS,
            useExisting: forwardRef(() => MarkdownEditorComponent),
            multi: true
        }
    ], viewQueries: [{ propertyName: "aceEditorContainer", first: true, predicate: ["aceEditor"], descendants: true, static: true }, { propertyName: "previewContainer", first: true, predicate: ["previewContainer"], descendants: true, static: true }], ngImport: i0, template: "<div class=\"md-editor-container\" [class.font-awesome5]=\"options?.usingFontAwesome5\" [class.fullscreen]=\"isFullScreen\"\r\n  [class.md-editor-resizable]=\"options?.resizable\" [style.height]=\"height\">\r\n  <div class=\"md-layout\">\r\n    <div class=\"tool-bar\" *ngIf=\"!hideToolbar && mode != 'preview'\">\r\n      <div class=\"btn-group\">\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Bold\" (click)=\"insertContent('Bold')\"\r\n          *ngIf=\"!hideIcons.Bold\">\r\n          <i class=\"fa fa-bold\"></i>\r\n        </button>\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Italic\" (click)=\"insertContent('Italic')\"\r\n          *ngIf=\"!hideIcons.Italic\">\r\n          <i class=\"fa fa-italic\"></i>\r\n        </button>\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Heading\" (click)=\"insertContent('Heading')\"\r\n          *ngIf=\"!hideIcons.Heading\">\r\n          <i class=\"fa fa-header\"></i>\r\n        </button>\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Reference\" (click)=\"insertContent('Reference')\"\r\n          *ngIf=\"!hideIcons.Reference\">\r\n          <i class=\"fa fa-quote-left\"></i>\r\n        </button>\r\n      </div>\r\n      <div class=\"btn-group\">\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Link\" (click)=\"insertContent('Link')\"\r\n          *ngIf=\"!hideIcons.Link\">\r\n          <i class=\"fa fa-link\"></i>\r\n        </button>\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Image\" (click)=\"insertContent('Image')\"\r\n          *ngIf=\"!hideIcons.Image\">\r\n          <i class=\"fa fa-image\"></i>\r\n        </button>\r\n      </div>\r\n      <div class=\"btn-group\">\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Unordered List\" (click)=\"insertContent('Ul')\"\r\n          *ngIf=\"!hideIcons.Ul\">\r\n          <i class=\"fa fa-list-ul\"></i>\r\n        </button>\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Ordered List\" (click)=\"insertContent('Ol')\"\r\n          *ngIf=\"!hideIcons.Ol\">\r\n          <i class=\"fa fa-list-ol\"></i>\r\n        </button>\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Code Block\" (click)=\"insertContent('Code')\"\r\n          *ngIf=\"!hideIcons.Code\">\r\n          <i class=\"fa fa-file-code-o\"></i>\r\n        </button>\r\n      </div>\r\n      <div class=\"btn-group\">\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\"\r\n          [attr.title]=\"showPreviewPanel ? 'Hide Preview' : 'Show Preview'\" (click)=\"togglePreview()\"\r\n          *ngIf=\"!hideIcons.TogglePreview\">\r\n          <i class=\"fa\" [class.fa-eye]=\"!showPreviewPanel\" [class.fa-eye-slash]=\"showPreviewPanel\"></i>\r\n        </button>\r\n      </div>\r\n      <div class=\"btn-group pull-right hide-split\">\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" [class.active]=\"isFullScreen\" (click)=\"fullScreen()\"\r\n          *ngIf=\"!hideIcons.FullScreen\">\r\n          <i class=\"fa\" [class.fa-arrows-alt]=\"!options?.usingFontAwesome5 || !isFullScreen\"\r\n            [class.fa-compress]=\"options?.usingFontAwesome5 && isFullScreen\"></i>\r\n        </button>\r\n      </div>\r\n    </div>\r\n    <div class=\"editor-container\">\r\n      <div [class.dragover]=\"dragover\" [style.display]=\"mode == 'preview' ? 'none' : null\"\r\n        (dragover)=\"onDragover($event)\">\r\n        <div class=\"drag-container\">\r\n          <div class=\"upload-loading\">\r\n            <i class=\"fa fa-upload\" *ngIf=\"!isUploading\"></i>\r\n            <i class=\"fa fa-spinner fa-pulse fa-fw\" *ngIf=\"isUploading\"></i>\r\n            <div class=\"text\">{{ isUploading ? 'Uploading' : 'Drag it here' }}</div>\r\n          </div>\r\n        </div>\r\n        <div class=\"drag-container drag-container-mask\" (drop)=\"onDrop($event)\" (dragleave)=\"onDragleave($event)\"></div>\r\n        <div class=\"editor-panel\" contenteditable=\"true\" (paste)=\"onAceEditorPaste($event)\">\r\n          <div class=\"ace-editor\" #aceEditor></div>\r\n        </div>\r\n      </div>\r\n      <div class=\"preview-container\" [style.display]=\"(mode == 'preview' || showPreviewPanel) ? 'block' : 'none'\"\r\n        (click)=\"previewPanelClick($event)\">\r\n        <div class=\"preview-panel\" #previewContainer></div>\r\n      </div>\r\n    </div>\r\n    <div class=\"md-footer\" *ngIf=\"maxlength > 0 && mode != 'preview'\">\r\n      <div class=\"text-right length-view\">\r\n        {{ markdownValue?.length }} / {{ maxlength }}\r\n      </div>\r\n      <div class=\"resize-btn\"></div>\r\n    </div>\r\n  </div>\r\n  <md-editor-resize-sensor *ngIf=\"options?.resizable\" (resize)=\"mdEditorResize($event)\"></md-editor-resize-sensor>\r\n</div>\r\n", styles: [".md-editor-container{position:relative;height:100%;margin-bottom:15px;border:1px solid rgba(0,0,0,.1)}.md-editor-container.fullscreen{margin:0;position:fixed;border:0;top:0;left:0;width:100%!important;height:100%!important;z-index:99999999}.md-editor-container.md-editor-resizable:not(.fullscreen){resize:both;overflow:hidden;display:inline-block;width:100%}.md-editor-container.md-editor-resizable:not(.fullscreen) .md-layout .editor-container{height:calc(100% - 70px)}.md-editor-container.md-editor-resizable:not(.fullscreen) .md-footer{z-index:-1}.md-editor-container.font-awesome5 .fa.fa-header:before{content:\"\\f1dc\"}.md-editor-container.font-awesome5 .fa.fa-file-code-o:before{content:\"\\f121\"}.md-editor-container.font-awesome5 .fa.fa-arrows-alt:before{content:\"\\f065\"}.md-editor-container .md-layout{height:100%;display:flex;flex-direction:column}.md-editor-container .md-layout .tool-bar{background-color:#f5f5f5;border-bottom:1px solid rgba(0,0,0,.1)}.md-editor-container .md-layout .tool-bar .btn-group{padding:6px}.md-editor-container .md-layout .tool-bar .btn-group:first-child>.btn:first-child:before{display:none}.md-editor-container .md-layout .tool-bar .btn-group>.btn:first-child:before{content:\" \";background-color:#a9a9a9;width:1px;height:24px;left:-9px;top:2px;position:absolute}.md-editor-container .md-layout .tool-bar .btn-group.hide-split>.btn:first-child:before{display:none}.md-editor-container .md-layout .tool-bar .btn{margin-bottom:0}.md-editor-container .md-layout .editor-container{flex:1;display:flex;height:calc(100% - 100px)}.md-editor-container .md-layout .editor-container>div{flex:1}.md-editor-container .md-layout .editor-container>div .drag-container{display:none}.md-editor-container .md-layout .editor-container>div.dragover{position:relative}.md-editor-container .md-layout .editor-container>div.dragover .drag-container{display:block;position:absolute;left:0;top:0;right:0;bottom:0;z-index:10;background-color:#0006;display:flex;align-items:center;justify-content:center;font-size:50px;color:#fff}.md-editor-container .md-layout .editor-container>div.dragover .drag-container.drag-container-mask{background-color:transparent;z-index:11}.md-editor-container .md-layout .editor-container>div.dragover .drag-container .upload-loading{display:flex;flex-direction:column;align-items:center}.md-editor-container .md-layout .editor-container>div.dragover .drag-container .upload-loading .text{font-size:20px;margin-top:10px}.md-editor-container .md-layout .editor-container .editor-panel{height:100%}.md-editor-container .md-layout .editor-container .editor-panel .ace-editor{height:100%;min-height:100%}.md-editor-container .md-layout .preview-container{overflow:auto}.md-editor-container .md-layout .preview-container .preview-panel{height:100%;border-left:1px solid rgba(0,0,0,.1);background-color:#fff;padding:10px}.md-editor-container .md-layout .md-footer{background-color:#f0f0f0;border-top:1px solid rgba(0,0,0,.1);display:flex;align-items:center}.md-editor-container .md-layout .md-footer .length-view{flex:1;padding:4px 2px 0;font-size:12px;line-height:16px}.md-editor-container .md-layout .md-footer .resize-btn{width:17px}.md-editor-container .pull-right{float:right}\n"], components: [{ type: i2.MarkdownEditorResizeSensorComponent, selector: "md-editor-resize-sensor", inputs: ["interval"], outputs: ["resize"] }], directives: [{ type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: MarkdownEditorComponent, decorators: [{
            type: Component,
            args: [{ selector: 'md-editor', providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef(() => MarkdownEditorComponent),
                            multi: true
                        },
                        {
                            provide: NG_VALIDATORS,
                            useExisting: forwardRef(() => MarkdownEditorComponent),
                            multi: true
                        }
                    ], template: "<div class=\"md-editor-container\" [class.font-awesome5]=\"options?.usingFontAwesome5\" [class.fullscreen]=\"isFullScreen\"\r\n  [class.md-editor-resizable]=\"options?.resizable\" [style.height]=\"height\">\r\n  <div class=\"md-layout\">\r\n    <div class=\"tool-bar\" *ngIf=\"!hideToolbar && mode != 'preview'\">\r\n      <div class=\"btn-group\">\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Bold\" (click)=\"insertContent('Bold')\"\r\n          *ngIf=\"!hideIcons.Bold\">\r\n          <i class=\"fa fa-bold\"></i>\r\n        </button>\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Italic\" (click)=\"insertContent('Italic')\"\r\n          *ngIf=\"!hideIcons.Italic\">\r\n          <i class=\"fa fa-italic\"></i>\r\n        </button>\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Heading\" (click)=\"insertContent('Heading')\"\r\n          *ngIf=\"!hideIcons.Heading\">\r\n          <i class=\"fa fa-header\"></i>\r\n        </button>\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Reference\" (click)=\"insertContent('Reference')\"\r\n          *ngIf=\"!hideIcons.Reference\">\r\n          <i class=\"fa fa-quote-left\"></i>\r\n        </button>\r\n      </div>\r\n      <div class=\"btn-group\">\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Link\" (click)=\"insertContent('Link')\"\r\n          *ngIf=\"!hideIcons.Link\">\r\n          <i class=\"fa fa-link\"></i>\r\n        </button>\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Image\" (click)=\"insertContent('Image')\"\r\n          *ngIf=\"!hideIcons.Image\">\r\n          <i class=\"fa fa-image\"></i>\r\n        </button>\r\n      </div>\r\n      <div class=\"btn-group\">\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Unordered List\" (click)=\"insertContent('Ul')\"\r\n          *ngIf=\"!hideIcons.Ul\">\r\n          <i class=\"fa fa-list-ul\"></i>\r\n        </button>\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Ordered List\" (click)=\"insertContent('Ol')\"\r\n          *ngIf=\"!hideIcons.Ol\">\r\n          <i class=\"fa fa-list-ol\"></i>\r\n        </button>\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" title=\"Code Block\" (click)=\"insertContent('Code')\"\r\n          *ngIf=\"!hideIcons.Code\">\r\n          <i class=\"fa fa-file-code-o\"></i>\r\n        </button>\r\n      </div>\r\n      <div class=\"btn-group\">\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\"\r\n          [attr.title]=\"showPreviewPanel ? 'Hide Preview' : 'Show Preview'\" (click)=\"togglePreview()\"\r\n          *ngIf=\"!hideIcons.TogglePreview\">\r\n          <i class=\"fa\" [class.fa-eye]=\"!showPreviewPanel\" [class.fa-eye-slash]=\"showPreviewPanel\"></i>\r\n        </button>\r\n      </div>\r\n      <div class=\"btn-group pull-right hide-split\">\r\n        <button class=\"btn btn-sm btn-default\" type=\"button\" [class.active]=\"isFullScreen\" (click)=\"fullScreen()\"\r\n          *ngIf=\"!hideIcons.FullScreen\">\r\n          <i class=\"fa\" [class.fa-arrows-alt]=\"!options?.usingFontAwesome5 || !isFullScreen\"\r\n            [class.fa-compress]=\"options?.usingFontAwesome5 && isFullScreen\"></i>\r\n        </button>\r\n      </div>\r\n    </div>\r\n    <div class=\"editor-container\">\r\n      <div [class.dragover]=\"dragover\" [style.display]=\"mode == 'preview' ? 'none' : null\"\r\n        (dragover)=\"onDragover($event)\">\r\n        <div class=\"drag-container\">\r\n          <div class=\"upload-loading\">\r\n            <i class=\"fa fa-upload\" *ngIf=\"!isUploading\"></i>\r\n            <i class=\"fa fa-spinner fa-pulse fa-fw\" *ngIf=\"isUploading\"></i>\r\n            <div class=\"text\">{{ isUploading ? 'Uploading' : 'Drag it here' }}</div>\r\n          </div>\r\n        </div>\r\n        <div class=\"drag-container drag-container-mask\" (drop)=\"onDrop($event)\" (dragleave)=\"onDragleave($event)\"></div>\r\n        <div class=\"editor-panel\" contenteditable=\"true\" (paste)=\"onAceEditorPaste($event)\">\r\n          <div class=\"ace-editor\" #aceEditor></div>\r\n        </div>\r\n      </div>\r\n      <div class=\"preview-container\" [style.display]=\"(mode == 'preview' || showPreviewPanel) ? 'block' : 'none'\"\r\n        (click)=\"previewPanelClick($event)\">\r\n        <div class=\"preview-panel\" #previewContainer></div>\r\n      </div>\r\n    </div>\r\n    <div class=\"md-footer\" *ngIf=\"maxlength > 0 && mode != 'preview'\">\r\n      <div class=\"text-right length-view\">\r\n        {{ markdownValue?.length }} / {{ maxlength }}\r\n      </div>\r\n      <div class=\"resize-btn\"></div>\r\n    </div>\r\n  </div>\r\n  <md-editor-resize-sensor *ngIf=\"options?.resizable\" (resize)=\"mdEditorResize($event)\"></md-editor-resize-sensor>\r\n</div>\r\n", styles: [".md-editor-container{position:relative;height:100%;margin-bottom:15px;border:1px solid rgba(0,0,0,.1)}.md-editor-container.fullscreen{margin:0;position:fixed;border:0;top:0;left:0;width:100%!important;height:100%!important;z-index:99999999}.md-editor-container.md-editor-resizable:not(.fullscreen){resize:both;overflow:hidden;display:inline-block;width:100%}.md-editor-container.md-editor-resizable:not(.fullscreen) .md-layout .editor-container{height:calc(100% - 70px)}.md-editor-container.md-editor-resizable:not(.fullscreen) .md-footer{z-index:-1}.md-editor-container.font-awesome5 .fa.fa-header:before{content:\"\\f1dc\"}.md-editor-container.font-awesome5 .fa.fa-file-code-o:before{content:\"\\f121\"}.md-editor-container.font-awesome5 .fa.fa-arrows-alt:before{content:\"\\f065\"}.md-editor-container .md-layout{height:100%;display:flex;flex-direction:column}.md-editor-container .md-layout .tool-bar{background-color:#f5f5f5;border-bottom:1px solid rgba(0,0,0,.1)}.md-editor-container .md-layout .tool-bar .btn-group{padding:6px}.md-editor-container .md-layout .tool-bar .btn-group:first-child>.btn:first-child:before{display:none}.md-editor-container .md-layout .tool-bar .btn-group>.btn:first-child:before{content:\" \";background-color:#a9a9a9;width:1px;height:24px;left:-9px;top:2px;position:absolute}.md-editor-container .md-layout .tool-bar .btn-group.hide-split>.btn:first-child:before{display:none}.md-editor-container .md-layout .tool-bar .btn{margin-bottom:0}.md-editor-container .md-layout .editor-container{flex:1;display:flex;height:calc(100% - 100px)}.md-editor-container .md-layout .editor-container>div{flex:1}.md-editor-container .md-layout .editor-container>div .drag-container{display:none}.md-editor-container .md-layout .editor-container>div.dragover{position:relative}.md-editor-container .md-layout .editor-container>div.dragover .drag-container{display:block;position:absolute;left:0;top:0;right:0;bottom:0;z-index:10;background-color:#0006;display:flex;align-items:center;justify-content:center;font-size:50px;color:#fff}.md-editor-container .md-layout .editor-container>div.dragover .drag-container.drag-container-mask{background-color:transparent;z-index:11}.md-editor-container .md-layout .editor-container>div.dragover .drag-container .upload-loading{display:flex;flex-direction:column;align-items:center}.md-editor-container .md-layout .editor-container>div.dragover .drag-container .upload-loading .text{font-size:20px;margin-top:10px}.md-editor-container .md-layout .editor-container .editor-panel{height:100%}.md-editor-container .md-layout .editor-container .editor-panel .ace-editor{height:100%;min-height:100%}.md-editor-container .md-layout .preview-container{overflow:auto}.md-editor-container .md-layout .preview-container .preview-panel{height:100%;border-left:1px solid rgba(0,0,0,.1);background-color:#fff;padding:10px}.md-editor-container .md-layout .md-footer{background-color:#f0f0f0;border-top:1px solid rgba(0,0,0,.1);display:flex;align-items:center}.md-editor-container .md-layout .md-footer .length-view{flex:1;padding:4px 2px 0;font-size:12px;line-height:16px}.md-editor-container .md-layout .md-footer .resize-btn{width:17px}.md-editor-container .pull-right{float:right}\n"] }]
        }], ctorParameters: function () { return [{ type: Object, decorators: [{
                    type: Inject,
                    args: [PLATFORM_ID]
                }] }, { type: undefined, decorators: [{
                    type: Attribute,
                    args: ['required']
                }] }, { type: undefined, decorators: [{
                    type: Attribute,
                    args: ['maxlength']
                }] }, { type: i0.NgZone }, { type: i0.Renderer2 }, { type: i1.DomSanitizer }]; }, propDecorators: { aceEditorContainer: [{
                type: ViewChild,
                args: ['aceEditor', { static: true }]
            }], previewContainer: [{
                type: ViewChild,
                args: ['previewContainer', { static: true }]
            }], hideToolbar: [{
                type: Input
            }], height: [{
                type: Input
            }], preRender: [{
                type: Input
            }], postRender: [{
                type: Input
            }], upload: [{
                type: Input
            }], mode: [{
                type: Input
            }], options: [{
                type: Input
            }], onEditorLoaded: [{
                type: Output
            }], onPreviewDomChanged: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWQtZWRpdG9yLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9saWIvbWQtZWRpdG9yLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uL3NyYy9saWIvbWQtZWRpdG9yLmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFhLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBc0IsTUFBTSxFQUFFLFdBQVcsRUFBRSxlQUFlLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDOUssT0FBTyxFQUFFLGlCQUFpQixFQUF3QixhQUFhLEVBQWdELE1BQU0sZ0JBQWdCLENBQUM7QUFDdEksT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUJBQWlCLENBQUM7Ozs7O0FBUXBELE1BQU0scUJBQXFCLEdBQW1CO0lBQzVDLGdCQUFnQixFQUFFLElBQUk7SUFDdEIsVUFBVSxFQUFFLElBQUk7SUFDaEIsU0FBUyxFQUFFLEVBQUU7SUFDYixpQkFBaUIsRUFBRSxLQUFLO0lBQ3hCLGFBQWEsRUFBRSxDQUFDO0lBQ2hCLHlCQUF5QixFQUFFLEtBQUs7SUFDaEMsU0FBUyxFQUFFLEtBQUs7Q0FDakIsQ0FBQTtBQW9CRCxNQUFNLE9BQU8sdUJBQXVCO0lBaUZsQyxZQUMrQixRQUFnQixFQUNmLFdBQW9CLEtBQUssRUFDeEIsWUFBb0IsQ0FBQyxDQUFDLEVBQzdDLE9BQWUsRUFDZixVQUFxQixFQUNyQixhQUEyQjtRQUxOLGFBQVEsR0FBUixRQUFRLENBQVE7UUFDZixhQUFRLEdBQVIsUUFBUSxDQUFpQjtRQUN4QixjQUFTLEdBQVQsU0FBUyxDQUFhO1FBQzdDLFlBQU8sR0FBUCxPQUFPLENBQVE7UUFDZixlQUFVLEdBQVYsVUFBVSxDQUFXO1FBQ3JCLGtCQUFhLEdBQWIsYUFBYSxDQUFjO1FBbkZyQixnQkFBVyxHQUFZLEtBQUssQ0FBQztRQUM3QixX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U0FBUztzQkFBeEIsS0FBSztnQkFDVSxVQUFVO3NCQUF6QixLQUFLO2dCQUNVLE1BQU07c0JBQXJCLEtBQUs7Z0JBR0ssSUFBSTtzQkFEZCxLQUFLO2dCQWlCSyxPQUFPO3NCQURqQixLQUFLO2dCQXFCVyxjQUFjO3NCQUE5QixNQUFNO2dCQUNVLG1CQUFtQjtzQkFBbkMsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgVmlld0NoaWxkLCBmb3J3YXJkUmVmLCBSZW5kZXJlcjIsIEF0dHJpYnV0ZSwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBFbGVtZW50UmVmLCBOZ1pvbmUsIEluamVjdCwgUExBVEZPUk1fSUQsIFNlY3VyaXR5Q29udGV4dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBOR19WQUxVRV9BQ0NFU1NPUiwgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE5HX1ZBTElEQVRPUlMsIFZhbGlkYXRvciwgQWJzdHJhY3RDb250cm9sLCBWYWxpZGF0aW9uRXJyb3JzIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBpc1BsYXRmb3JtQnJvd3NlciB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcbmltcG9ydCB7IERvbVNhbml0aXplciB9IGZyb20gJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXInO1xyXG5pbXBvcnQgeyBNZEVkaXRvck9wdGlvbiwgTWFya2VkanNPcHRpb24gfSBmcm9tICcuL21kLWVkaXRvci50eXBlcyc7XHJcblxyXG5kZWNsYXJlIGxldCBhY2U6IGFueTtcclxuZGVjbGFyZSBsZXQgbWFya2VkOiBhbnk7XHJcbmRlY2xhcmUgbGV0IGhsanM6IGFueTtcclxuXHJcbmNvbnN0IERFRkFVTFRfRURJVE9SX09QVElPTjogTWRFZGl0b3JPcHRpb24gPSB7XHJcbiAgc2hvd1ByZXZpZXdQYW5lbDogdHJ1ZSxcclxuICBzaG93Qm9yZGVyOiB0cnVlLFxyXG4gIGhpZGVJY29uczogW10sXHJcbiAgdXNpbmdGb250QXdlc29tZTU6IGZhbHNlLFxyXG4gIHNjcm9sbFBhc3RFbmQ6IDAsXHJcbiAgZW5hYmxlUHJldmlld0NvbnRlbnRDbGljazogZmFsc2UsXHJcbiAgcmVzaXphYmxlOiBmYWxzZVxyXG59XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ21kLWVkaXRvcicsXHJcbiAgc3R5bGVVcmxzOiBbJy4vbWQtZWRpdG9yLnNjc3MnXSxcclxuICB0ZW1wbGF0ZVVybDogJy4vbWQtZWRpdG9yLmh0bWwnLFxyXG4gIHByb3ZpZGVyczogW1xyXG4gICAge1xyXG4gICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcclxuICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gTWFya2Rvd25FZGl0b3JDb21wb25lbnQpLFxyXG4gICAgICBtdWx0aTogdHJ1ZVxyXG4gICAgfSxcclxuICAgIHtcclxuICAgICAgcHJvdmlkZTogTkdfVkFMSURBVE9SUyxcclxuICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gTWFya2Rvd25FZGl0b3JDb21wb25lbnQpLFxyXG4gICAgICBtdWx0aTogdHJ1ZVxyXG4gICAgfVxyXG4gIF1cclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBNYXJrZG93bkVkaXRvckNvbXBvbmVudCBpbXBsZW1lbnRzIENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBWYWxpZGF0b3Ige1xyXG5cclxuICBAVmlld0NoaWxkKCdhY2VFZGl0b3InLCB7IHN0YXRpYzogdHJ1ZSB9KSBwdWJsaWMgYWNlRWRpdG9yQ29udGFpbmVyOiBFbGVtZW50UmVmO1xyXG4gIEBWaWV3Q2hpbGQoJ3ByZXZpZXdDb250YWluZXInLCB7IHN0YXRpYzogdHJ1ZSB9KSBwdWJsaWMgcHJldmlld0NvbnRhaW5lcjogRWxlbWVudFJlZjtcclxuICBASW5wdXQoKSBwdWJsaWMgaGlkZVRvb2xiYXI6IGJvb2xlYW4gPSBmYWxzZTtcclxuICBASW5wdXQoKSBwdWJsaWMgaGVpZ2h0OiBzdHJpbmcgPSBcIjMwMHB4XCI7XHJcbiAgQElucHV0KCkgcHVibGljIHByZVJlbmRlcjogRnVuY3Rpb247XHJcbiAgQElucHV0KCkgcHVibGljIHBvc3RSZW5kZXI6IEZ1bmN0aW9uO1xyXG4gIEBJbnB1dCgpIHB1YmxpYyB1cGxvYWQ6IEZ1bmN0aW9uO1xyXG5cclxuICBASW5wdXQoKVxyXG4gIHB1YmxpYyBnZXQgbW9kZSgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMuX21vZGU7XHJcbiAgfVxyXG4gIHB1YmxpYyBzZXQgbW9kZSh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICB0aGlzLl9tb2RlID0gKCF2YWx1ZSB8fCBbJ2VkaXRvcicsICdwcmV2aWV3J10uaW5kZXhPZih2YWx1ZS50b0xvd2VyQ2FzZSgpKSA9PT0gLTEpXHJcbiAgICAgID8gJ2VkaXRvcidcclxuICAgICAgOiB2YWx1ZTtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5fYWNlRWRpdG9ySW5zICYmIHR5cGVvZiB0aGlzLl9hY2VFZGl0b3JJbnMucmVzaXplID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgdGhpcy5fYWNlRWRpdG9ySW5zLnJlc2l6ZSgpO1xyXG4gICAgICB9XHJcbiAgICB9LCAxMDApO1xyXG4gIH1cclxuICBwcml2YXRlIF9tb2RlOiBzdHJpbmcgPSAnZWRpdG9yJztcclxuXHJcbiAgQElucHV0KClcclxuICBwdWJsaWMgZ2V0IG9wdGlvbnMoKTogTWRFZGl0b3JPcHRpb24ge1xyXG4gICAgcmV0dXJuIHRoaXMuX29wdGlvbnMgfHwge307XHJcbiAgfVxyXG4gIHB1YmxpYyBzZXQgb3B0aW9ucyh2YWx1ZTogTWRFZGl0b3JPcHRpb24pIHtcclxuICAgIGxldCBfb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oREVGQVVMVF9FRElUT1JfT1BUSU9OLCB7fSwgdmFsdWUpO1xyXG4gICAgbGV0IF9oaWRlSWNvbnMgPSB7fTtcclxuICAgIGlmICh0eXBlb2YgX29wdGlvbnMuc2hvd1ByZXZpZXdQYW5lbCA9PT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICAgIHRoaXMuc2hvd1ByZXZpZXdQYW5lbCA9IF9vcHRpb25zLnNob3dQcmV2aWV3UGFuZWw7XHJcbiAgICB9XHJcbiAgICBpZiAoQXJyYXkuaXNBcnJheShfb3B0aW9ucy5oaWRlSWNvbnMpKSB7XHJcbiAgICAgIF9vcHRpb25zLmhpZGVJY29ucy5mb3JFYWNoKCh2OiBhbnkpID0+IHtcclxuICAgICAgICBpZiAodiA9PT0gJ1JlZnJlbmNlJykgdiA9ICdSZWZlcmVuY2UnO1xyXG4gICAgICAgIF9oaWRlSWNvbnNbdl0gPSB0cnVlXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgdGhpcy5fb3B0aW9ucyA9IF9vcHRpb25zO1xyXG4gICAgdGhpcy5oaWRlSWNvbnMgPSBfaGlkZUljb25zO1xyXG4gIH1cclxuICBwcml2YXRlIF9vcHRpb25zOiBhbnkgPSB7fTtcclxuXHJcbiAgQE91dHB1dCgpIHB1YmxpYyBvbkVkaXRvckxvYWRlZDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICBAT3V0cHV0KCkgcHVibGljIG9uUHJldmlld0RvbUNoYW5nZWQ6IEV2ZW50RW1pdHRlcjxIVE1MRWxlbWVudD4gPSBuZXcgRXZlbnRFbWl0dGVyPEhUTUxFbGVtZW50PigpO1xyXG5cclxuICBwdWJsaWMgaGlkZUljb25zOiBhbnkgPSB7fTtcclxuICBwdWJsaWMgc2hvd1ByZXZpZXdQYW5lbDogYm9vbGVhbiA9IHRydWU7XHJcbiAgcHVibGljIGlzRnVsbFNjcmVlbjogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIHB1YmxpYyBkcmFnb3ZlcjogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIHB1YmxpYyBpc1VwbG9hZGluZzogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICAvLyNyZWdpb24gTWFya2Rvd24gdmFsdWUgYW5kIGh0bWwgdmFsdWUgZGVmaW5lXHJcbiAgcHVibGljIGdldCBtYXJrZG93blZhbHVlKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gdGhpcy5fbWFya2Rvd25WYWx1ZSB8fCAnJztcclxuICB9XHJcbiAgcHJpdmF0ZSBfbWFya2Rvd25WYWx1ZTogc3RyaW5nO1xyXG5cclxuICBwdWJsaWMgcHJldmlld0h0bWw6IGFueTtcclxuICAvLyNlbmRyZWdpb25cclxuXHJcblxyXG4gIHByaXZhdGUgX2FjZUVkaXRvckluczogYW55O1xyXG4gIHByaXZhdGUgX2FjZUVkaXRvclJlc2l6ZVRpbWVyOiBhbnk7XHJcbiAgcHJpdmF0ZSBfY29udmVydE1hcmtkb3duVG9IdG1sVGltZXI6IGFueTtcclxuICBwcml2YXRlIF9tYXJrZWRKc09wdDogTWFya2VkanNPcHRpb247XHJcbiAgcHJpdmF0ZSBfaXNWYWx1ZVNldHRlZEJ5cHJvZ3JhbW1hdGljYWxseTogYm9vbGVhbjtcclxuICBwcml2YXRlIGdldCBfaGFzVXBsb2FkRnVuY3Rpb24oKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy51cGxvYWQgJiYgdGhpcy51cGxvYWQgaW5zdGFuY2VvZiBGdW5jdGlvbjtcclxuICB9XHJcbiAgcHJpdmF0ZSBnZXQgX2lzSW5Ccm93c2VyKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIGlzUGxhdGZvcm1Ccm93c2VyKHRoaXMucGxhdGZvcm0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfb25DaGFuZ2UgPSAoXzogYW55KSA9PiB7IH07XHJcbiAgcHJpdmF0ZSBfb25Ub3VjaGVkID0gKCkgPT4geyB9O1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIEBJbmplY3QoUExBVEZPUk1fSUQpIHByaXZhdGUgcGxhdGZvcm06IE9iamVjdCxcclxuICAgIEBBdHRyaWJ1dGUoJ3JlcXVpcmVkJykgcHVibGljIHJlcXVpcmVkOiBib29sZWFuID0gZmFsc2UsXHJcbiAgICBAQXR0cmlidXRlKCdtYXhsZW5ndGgnKSBwdWJsaWMgbWF4bGVuZ3RoOiBudW1iZXIgPSAtMSxcclxuICAgIHByaXZhdGUgX25nWm9uZTogTmdab25lLFxyXG4gICAgcHJpdmF0ZSBfcmVuZGVyZXIyOiBSZW5kZXJlcjIsXHJcbiAgICBwcml2YXRlIF9kb21TYW5pdGl6ZXI6IERvbVNhbml0aXplcikge1xyXG5cclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgaWYgKCF0aGlzLl9pc0luQnJvd3NlcikgcmV0dXJuO1xyXG4gICAgbGV0IG1hcmtlZFJlbmRlciA9IG5ldyBtYXJrZWQuUmVuZGVyZXIoKTtcclxuICAgIG1hcmtlZFJlbmRlci5pbWFnZSA9IHRoaXMuX2dldFJlbmRlcignaW1hZ2UnKTtcclxuICAgIG1hcmtlZFJlbmRlci5jb2RlID0gdGhpcy5fZ2V0UmVuZGVyKCdjb2RlJyk7XHJcbiAgICBtYXJrZWRSZW5kZXIudGFibGUgPSB0aGlzLl9nZXRSZW5kZXIoJ3RhYmxlJyk7XHJcbiAgICBtYXJrZWRSZW5kZXIubGlzdGl0ZW0gPSB0aGlzLl9nZXRSZW5kZXIoJ2xpc3RpdGVtJyk7XHJcbiAgICBsZXQgbWFya2VkanNPcHQgPSB7XHJcbiAgICAgIHJlbmRlcmVyOiBtYXJrZWRSZW5kZXIsXHJcbiAgICAgIGhpZ2hsaWdodDogKGNvZGU6IGFueSkgPT4gaGxqcy5oaWdobGlnaHRBdXRvKGNvZGUpLnZhbHVlXHJcbiAgICB9O1xyXG4gICAgdGhpcy5fbWFya2VkSnNPcHQgPSBPYmplY3QuYXNzaWduKHt9LCBtYXJrZWRqc09wdCwgdGhpcy5vcHRpb25zLm1hcmtlZGpzT3B0KTtcclxuICAgIGlmICh0aGlzLl9tYXJrZWRKc09wdC5zYW5pdGl6ZSA9PT0gdHJ1ZSAmJiB0eXBlb2YgdGhpcy5fbWFya2VkSnNPcHQuc2FuaXRpemVyICE9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHRoaXMuX21hcmtlZEpzT3B0LnNhbml0aXplciA9IChtYXJrZG93blN0cmluZykgPT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9kb21TYW5pdGl6ZXIuc2FuaXRpemUoU2VjdXJpdHlDb250ZXh0LkhUTUwsIG1hcmtkb3duU3RyaW5nKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgaWYgKCF0aGlzLl9pc0luQnJvd3NlcikgcmV0dXJuO1xyXG4gICAgbGV0IGVkaXRvckVsZW1lbnQgPSB0aGlzLmFjZUVkaXRvckNvbnRhaW5lci5uYXRpdmVFbGVtZW50O1xyXG4gICAgbGV0IGVkaXRvciA9IGFjZS5lZGl0KGVkaXRvckVsZW1lbnQpO1xyXG4gICAgZWRpdG9yLiRibG9ja1Njcm9sbGluZyA9IEluZmluaXR5O1xyXG4gICAgZWRpdG9yLmdldFNlc3Npb24oKS5zZXRVc2VXcmFwTW9kZSh0cnVlKTtcclxuICAgIGVkaXRvci5nZXRTZXNzaW9uKCkuc2V0TW9kZShcImFjZS9tb2RlL21hcmtkb3duXCIpO1xyXG4gICAgZWRpdG9yLnNldFZhbHVlKHRoaXMubWFya2Rvd25WYWx1ZSwgMSk7XHJcbiAgICBlZGl0b3Iuc2V0T3B0aW9uKCdzY3JvbGxQYXN0RW5kJywgdGhpcy5fb3B0aW9ucy5zY3JvbGxQYXN0RW5kIHx8IDApO1xyXG5cclxuICAgIGVkaXRvci5vbignY2hhbmdlJywgKGU6IGFueSkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5faXNWYWx1ZVNldHRlZEJ5cHJvZ3JhbW1hdGljYWxseSkgcmV0dXJuO1xyXG4gICAgICBsZXQgdmFsID0gZWRpdG9yLmdldFZhbHVlKCk7XHJcbiAgICAgIHRoaXMuX3VwZGF0ZU1hcmtkb3duVmFsdWUodmFsLCB0cnVlKTtcclxuICAgICAgdGhpcy5fb25DaGFuZ2UodGhpcy5tYXJrZG93blZhbHVlKTtcclxuICAgIH0pO1xyXG4gICAgZWRpdG9yLm9uKCdibHVyJywgKCkgPT4geyB0aGlzLl9vblRvdWNoZWQoKSB9KTtcclxuXHJcbiAgICB0aGlzLm9uRWRpdG9yTG9hZGVkLm5leHQoZWRpdG9yKTtcclxuICAgIHRoaXMuX2FjZUVkaXRvcklucyA9IGVkaXRvcjtcclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCkge1xyXG4gICAgdGhpcy5fYWNlRWRpdG9ySW5zICYmIHRoaXMuX2FjZUVkaXRvcklucy5kZXN0cm95KCk7XHJcbiAgfVxyXG5cclxuICB3cml0ZVZhbHVlKHZhbHVlOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIHRoaXMuX3VwZGF0ZU1hcmtkb3duVmFsdWUodmFsdWUsIGZhbHNlKTtcclxuICB9XHJcblxyXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46IChfOiBhbnkpID0+IHt9KTogdm9pZCB7XHJcbiAgICB0aGlzLl9vbkNoYW5nZSA9IGZuO1xyXG4gIH1cclxuXHJcbiAgcmVnaXN0ZXJPblRvdWNoZWQoZm46ICgpID0+IHt9KTogdm9pZCB7XHJcbiAgICB0aGlzLl9vblRvdWNoZWQgPSBmbjtcclxuICB9XHJcblxyXG4gIHZhbGlkYXRlKGM6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMge1xyXG4gICAgbGV0IHJlc3VsdDogYW55ID0gbnVsbDtcclxuICAgIGlmICh0aGlzLnJlcXVpcmVkICYmIHRoaXMubWFya2Rvd25WYWx1ZS5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmVzdWx0ID0geyByZXF1aXJlZDogdHJ1ZSB9O1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMubWF4bGVuZ3RoID4gMCAmJiB0aGlzLm1hcmtkb3duVmFsdWUubGVuZ3RoID4gdGhpcy5tYXhsZW5ndGgpIHtcclxuICAgICAgcmVzdWx0ID0geyBtYXhsZW5ndGg6IHRydWUgfTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG5cclxuICBpbnNlcnRDb250ZW50KHR5cGU6IHN0cmluZywgY3VzdG9tQ29udGVudD86IHN0cmluZykge1xyXG4gICAgaWYgKCF0aGlzLl9hY2VFZGl0b3JJbnMpIHJldHVybjtcclxuICAgIGxldCBzZWxlY3RlZFRleHQgPSB0aGlzLl9hY2VFZGl0b3JJbnMuZ2V0U2VsZWN0ZWRUZXh0KCk7XHJcbiAgICBsZXQgaXNTZWxlY3RlZCA9ICEhc2VsZWN0ZWRUZXh0O1xyXG4gICAgbGV0IHN0YXJ0U2l6ZSA9IDI7XHJcbiAgICBsZXQgaW5pdFRleHQ6IHN0cmluZyA9ICcnO1xyXG4gICAgbGV0IHJhbmdlID0gdGhpcy5fYWNlRWRpdG9ySW5zLnNlbGVjdGlvbi5nZXRSYW5nZSgpO1xyXG4gICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgIGNhc2UgJ0JvbGQnOlxyXG4gICAgICAgIGluaXRUZXh0ID0gJ0JvbGQgVGV4dCc7XHJcbiAgICAgICAgc2VsZWN0ZWRUZXh0ID0gYCoqJHtzZWxlY3RlZFRleHQgfHwgaW5pdFRleHR9KipgO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdJdGFsaWMnOlxyXG4gICAgICAgIGluaXRUZXh0ID0gJ0l0YWxpYyBUZXh0JztcclxuICAgICAgICBzZWxlY3RlZFRleHQgPSBgKiR7c2VsZWN0ZWRUZXh0IHx8IGluaXRUZXh0fSpgO1xyXG4gICAgICAgIHN0YXJ0U2l6ZSA9IDE7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ0hlYWRpbmcnOlxyXG4gICAgICAgIGluaXRUZXh0ID0gJ0hlYWRpbmcnO1xyXG4gICAgICAgIHNlbGVjdGVkVGV4dCA9IGAjICR7c2VsZWN0ZWRUZXh0IHx8IGluaXRUZXh0fWA7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ1JlZmVyZW5jZSc6XHJcbiAgICAgICAgaW5pdFRleHQgPSAnUmVmZXJlbmNlJztcclxuICAgICAgICBzZWxlY3RlZFRleHQgPSBgPiAke3NlbGVjdGVkVGV4dCB8fCBpbml0VGV4dH1gO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdMaW5rJzpcclxuICAgICAgICBzZWxlY3RlZFRleHQgPSBgW10oaHR0cDovLylgO1xyXG4gICAgICAgIHN0YXJ0U2l6ZSA9IDE7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ0ltYWdlJzpcclxuICAgICAgICBzZWxlY3RlZFRleHQgPSBgIVtdKGh0dHA6Ly8pYDtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnVWwnOlxyXG4gICAgICAgIHNlbGVjdGVkVGV4dCA9IGAtICR7c2VsZWN0ZWRUZXh0IHx8IGluaXRUZXh0fWBcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnT2wnOlxyXG4gICAgICAgIHNlbGVjdGVkVGV4dCA9IGAxLiAke3NlbGVjdGVkVGV4dCB8fCBpbml0VGV4dH1gXHJcbiAgICAgICAgc3RhcnRTaXplID0gMztcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnQ29kZSc6XHJcbiAgICAgICAgaW5pdFRleHQgPSAnU291cmNlIENvZGUnO1xyXG4gICAgICAgIHNlbGVjdGVkVGV4dCA9IFwiYGBgbGFuZ3VhZ2VcXHJcXG5cIiArIChzZWxlY3RlZFRleHQgfHwgaW5pdFRleHQpICsgXCJcXHJcXG5gYGBcIjtcclxuICAgICAgICBzdGFydFNpemUgPSAzO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICdDdXN0b20nOlxyXG4gICAgICAgIHNlbGVjdGVkVGV4dCA9IGN1c3RvbUNvbnRlbnQ7XHJcbiAgICAgICAgc3RhcnRTaXplID0gMDtcclxuICAgICAgICBicmVhaztcclxuICAgIH1cclxuICAgIHRoaXMuX2FjZUVkaXRvcklucy5zZXNzaW9uLnJlcGxhY2UocmFuZ2UsIHNlbGVjdGVkVGV4dCk7XHJcbiAgICBpZiAoIWlzU2VsZWN0ZWQpIHtcclxuICAgICAgcmFuZ2Uuc3RhcnQuY29sdW1uICs9IHN0YXJ0U2l6ZTtcclxuICAgICAgcmFuZ2UuZW5kLmNvbHVtbiA9IHJhbmdlLnN0YXJ0LmNvbHVtbiArIGluaXRUZXh0Lmxlbmd0aDtcclxuICAgICAgdGhpcy5fYWNlRWRpdG9ySW5zLnNlbGVjdGlvbi5zZXRSYW5nZShyYW5nZSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLl9hY2VFZGl0b3JJbnMuZm9jdXMoKTtcclxuICB9XHJcblxyXG4gIHRvZ2dsZVByZXZpZXcoKSB7XHJcbiAgICB0aGlzLnNob3dQcmV2aWV3UGFuZWwgPSAhdGhpcy5zaG93UHJldmlld1BhbmVsO1xyXG4gICAgdGhpcy5lZGl0b3JSZXNpemUoKTtcclxuICB9XHJcblxyXG4gIHByZXZpZXdQYW5lbENsaWNrKGV2ZW50OiBFdmVudCkge1xyXG4gICAgaWYgKHRoaXMub3B0aW9ucy5lbmFibGVQcmV2aWV3Q29udGVudENsaWNrICE9PSB0cnVlKSB7XHJcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZnVsbFNjcmVlbigpIHtcclxuICAgIHRoaXMuaXNGdWxsU2NyZWVuID0gIXRoaXMuaXNGdWxsU2NyZWVuO1xyXG4gICAgdGhpcy5fcmVuZGVyZXIyLnNldFN0eWxlKGRvY3VtZW50LmJvZHksICdvdmVyZmxvd1knLCB0aGlzLmlzRnVsbFNjcmVlbiA/ICdoaWRkZW4nIDogJ2F1dG8nKTtcclxuICAgIHRoaXMuZWRpdG9yUmVzaXplKCk7XHJcbiAgfVxyXG5cclxuICBtZEVkaXRvclJlc2l6ZShzaXplOiBhbnkpIHtcclxuICAgIHRoaXMuZWRpdG9yUmVzaXplKCk7XHJcbiAgfVxyXG5cclxuICBlZGl0b3JSZXNpemUodGltZU91dDogbnVtYmVyID0gMTAwKSB7XHJcbiAgICBpZiAoIXRoaXMuX2FjZUVkaXRvcklucykgcmV0dXJuXHJcbiAgICBpZiAodGhpcy5fYWNlRWRpdG9yUmVzaXplVGltZXIpIGNsZWFyVGltZW91dCh0aGlzLl9hY2VFZGl0b3JSZXNpemVUaW1lcik7XHJcbiAgICB0aGlzLl9hY2VFZGl0b3JSZXNpemVUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICB0aGlzLl9hY2VFZGl0b3JJbnMucmVzaXplKCk7XHJcbiAgICAgIHRoaXMuX2FjZUVkaXRvcklucy5mb2N1cygpO1xyXG4gICAgfSwgdGltZU91dCk7XHJcbiAgfVxyXG5cclxuICBvbkRyYWdvdmVyKGV2dDogRHJhZ0V2ZW50KSB7XHJcbiAgICBldnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XHJcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIGlmICghdGhpcy5faGFzVXBsb2FkRnVuY3Rpb24pIHJldHVybjtcclxuICAgIHRoaXMuZHJhZ292ZXIgPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgb25Ecm9wKGV2dDogRHJhZ0V2ZW50KSB7XHJcbiAgICBldnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XHJcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICB0aGlzLl91cGxvYWRGaWxlcyhldnQuZGF0YVRyYW5zZmVyLmZpbGVzKTtcclxuICB9XHJcblxyXG4gIG9uRHJhZ2xlYXZlKGV2dDogRHJhZ0V2ZW50KSB7XHJcbiAgICBldnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XHJcbiAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIGlmICghdGhpcy5faGFzVXBsb2FkRnVuY3Rpb24pIHJldHVybjtcclxuICAgIHRoaXMuZHJhZ292ZXIgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIG9uQWNlRWRpdG9yUGFzdGUoZXZlbnQ6IENsaXBib2FyZEV2ZW50KTogdm9pZCB7XHJcbiAgICBpZiAoZXZlbnQgaW5zdGFuY2VvZiBDbGlwYm9hcmRFdmVudCAmJiBldmVudC5jbGlwYm9hcmREYXRhLmZpbGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgdGhpcy5fdXBsb2FkRmlsZXMoZXZlbnQuY2xpcGJvYXJkRGF0YS5maWxlcyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF91cGRhdGVNYXJrZG93blZhbHVlKHZhbHVlOiBhbnksIGNoYW5nZWRCeVVzZXI6IGJvb2xlYW4gPSBmYWxzZSkge1xyXG4gICAgY29uc3Qgbm9ybWFsaXplZFZhbHVlID0gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyA/IHZhbHVlIDogKHZhbHVlIHx8ICcnKS50b1N0cmluZygpO1xyXG4gICAgaWYgKHRoaXMuX21hcmtkb3duVmFsdWUgPT09IG5vcm1hbGl6ZWRWYWx1ZSkgcmV0dXJuO1xyXG4gICAgdGhpcy5fbWFya2Rvd25WYWx1ZSA9IG5vcm1hbGl6ZWRWYWx1ZTtcclxuICAgIHRoaXMuX3VwZGF0ZURvbSgpO1xyXG4gICAgaWYgKHRoaXMuX2FjZUVkaXRvcklucyAmJiAhY2hhbmdlZEJ5VXNlcikge1xyXG4gICAgICB0aGlzLl9pc1ZhbHVlU2V0dGVkQnlwcm9ncmFtbWF0aWNhbGx5ID0gdHJ1ZTtcclxuICAgICAgdGhpcy5fYWNlRWRpdG9ySW5zLnNldFZhbHVlKG5vcm1hbGl6ZWRWYWx1ZSwgMSk7XHJcbiAgICAgIHRoaXMuX2lzVmFsdWVTZXR0ZWRCeXByb2dyYW1tYXRpY2FsbHkgPSBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgX3VwZGF0ZURvbSgpIHtcclxuICAgIGlmICh0aGlzLl9jb252ZXJ0TWFya2Rvd25Ub0h0bWxUaW1lcikgY2xlYXJUaW1lb3V0KHRoaXMuX2NvbnZlcnRNYXJrZG93blRvSHRtbFRpbWVyKTtcclxuICAgIHRoaXMuX2NvbnZlcnRNYXJrZG93blRvSHRtbFRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIFByb21pc2UucmVzb2x2ZSh0aGlzLm1hcmtkb3duVmFsdWUpXHJcbiAgICAgICAgLnRoZW4oKG1kQ29udGVudCkgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuICh0aGlzLnByZVJlbmRlciAmJiB0aGlzLnByZVJlbmRlciBpbnN0YW5jZW9mIEZ1bmN0aW9uKSA/IHRoaXMucHJlUmVuZGVyKG1kQ29udGVudCkgOiBtZENvbnRlbnQ7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAudGhlbihtZENvbnRlbnQgPT4ge1xyXG4gICAgICAgICAgbGV0IGh0bWwgPSBtYXJrZWQobWRDb250ZW50IHx8ICcnLCB0aGlzLl9tYXJrZWRKc09wdCk7XHJcbiAgICAgICAgICByZXR1cm4gKHRoaXMucG9zdFJlbmRlciAmJiB0aGlzLnBvc3RSZW5kZXIgaW5zdGFuY2VvZiBGdW5jdGlvbikgPyB0aGlzLnBvc3RSZW5kZXIoaHRtbCkgOiBodG1sO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4ocGFyc2VkSHRtbCA9PiB7XHJcbiAgICAgICAgICB0aGlzLnByZXZpZXdIdG1sID0gdGhpcy5fZG9tU2FuaXRpemVyLmJ5cGFzc1NlY3VyaXR5VHJ1c3RIdG1sKHBhcnNlZEh0bWwpO1xyXG4gICAgICAgICAgaWYgKHRoaXMucHJldmlld0NvbnRhaW5lciAmJiB0aGlzLnByZXZpZXdDb250YWluZXIubmF0aXZlRWxlbWVudCkge1xyXG4gICAgICAgICAgICB0aGlzLl9uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVyMi5zZXRQcm9wZXJ0eSh0aGlzLnByZXZpZXdDb250YWluZXIubmF0aXZlRWxlbWVudCwgJ2lubmVySFRNTCcsIHBhcnNlZEh0bWwpO1xyXG4gICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyB0aGlzLm9uUHJldmlld0RvbUNoYW5nZWQubmV4dCh0aGlzLnByZXZpZXdDb250YWluZXIubmF0aXZlRWxlbWVudCk7IH0sIDEwMCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgfSlcclxuICAgIH0sIDEwMCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9nZXRSZW5kZXIocmVuZGVyVHlwZTogJ2ltYWdlJyB8ICd0YWJsZScgfCAnY29kZScgfCAnbGlzdGl0ZW0nKSB7XHJcbiAgICBsZXQgY3VzdG9tUmVuZGVyID0gdGhpcy5vcHRpb25zICYmIHRoaXMub3B0aW9ucy5jdXN0b21SZW5kZXIgJiYgdGhpcy5vcHRpb25zLmN1c3RvbVJlbmRlcltyZW5kZXJUeXBlXTtcclxuICAgIGlmIChjdXN0b21SZW5kZXIgJiYgdHlwZW9mIGN1c3RvbVJlbmRlciA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICByZXR1cm4gY3VzdG9tUmVuZGVyO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc3dpdGNoIChyZW5kZXJUeXBlKSB7XHJcbiAgICAgICAgY2FzZSAnaW1hZ2UnOlxyXG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChocmVmOiBzdHJpbmcsIHRpdGxlOiBzdHJpbmcsIHRleHQ6IHN0cmluZykge1xyXG4gICAgICAgICAgICBsZXQgb3V0ID0gYDxpbWcgc3R5bGU9XCJtYXgtd2lkdGg6IDEwMCU7XCIgc3JjPVwiJHtocmVmfVwiIGFsdD1cIiR7dGV4dH1cImA7XHJcbiAgICAgICAgICAgIGlmICh0aXRsZSkge1xyXG4gICAgICAgICAgICAgIG91dCArPSBgIHRpdGxlPVwiJHt0aXRsZX1cImA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb3V0ICs9ICg8YW55PnRoaXMub3B0aW9ucykueGh0bWwgPyBcIi8+XCIgOiBcIj5cIjtcclxuICAgICAgICAgICAgcmV0dXJuIG91dDtcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgY2FzZSAnY29kZSc6XHJcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGNvZGU6IGFueSwgbGFuZ3VhZ2U6IGFueSkge1xyXG4gICAgICAgICAgICBsZXQgdmFsaWRMYW5nID0gISEobGFuZ3VhZ2UgJiYgaGxqcy5nZXRMYW5ndWFnZShsYW5ndWFnZSkpO1xyXG4gICAgICAgICAgICBsZXQgaGlnaGxpZ2h0ZWQgPSAnJztcclxuICAgICAgICAgICAgaWYgKHZhbGlkTGFuZykge1xyXG4gICAgICAgICAgICAgIGhpZ2hsaWdodGVkID0gaGxqcy5oaWdobGlnaHQobGFuZ3VhZ2UsIGNvZGUpLnZhbHVlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIGxldCBwcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwcmUnKTtcclxuICAgICAgICAgICAgICBwcmUuaW5uZXJUZXh0ID0gY29kZTtcclxuICAgICAgICAgICAgICBoaWdobGlnaHRlZCA9IHByZS5pbm5lckhUTUw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGA8cHJlIHN0eWxlPVwicGFkZGluZzogMDsgYm9yZGVyLXJhZGl1czogMDtcIj48Y29kZSBjbGFzcz1cImhsanMgJHtsYW5ndWFnZX1cIj4ke2hpZ2hsaWdodGVkfTwvY29kZT48L3ByZT5gO1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICBjYXNlICd0YWJsZSc6XHJcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGhlYWRlcjogc3RyaW5nLCBib2R5OiBzdHJpbmcpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGA8dGFibGUgY2xhc3M9XCJ0YWJsZSB0YWJsZS1ib3JkZXJlZFwiPlxcbjx0aGVhZD5cXG4ke2hlYWRlcn08L3RoZWFkPlxcbjx0Ym9keT5cXG4ke2JvZHl9PC90Ym9keT5cXG48L3RhYmxlPlxcbmA7XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgIGNhc2UgJ2xpc3RpdGVtJzpcclxuICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAodGV4dDogYW55LCB0YXNrOiBib29sZWFuLCBjaGVja2VkOiBib29sZWFuKSB7XHJcbiAgICAgICAgICAgIGlmICgvXlxccypcXFtbeCBdXFxdXFxzKi8udGVzdCh0ZXh0KSB8fCB0ZXh0LnN0YXJ0c1dpdGgoJzxpbnB1dCcpKSB7XHJcbiAgICAgICAgICAgICAgaWYgKHRleHQuc3RhcnRzV2l0aCgnPGlucHV0JykpIHtcclxuICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0XHJcbiAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCc8aW5wdXQgZGlzYWJsZWQ9XCJcIiB0eXBlPVwiY2hlY2tib3hcIj4nLCAnPGkgY2xhc3M9XCJmYSBmYS1zcXVhcmUtb1wiPjwvaT4nKVxyXG4gICAgICAgICAgICAgICAgICAucmVwbGFjZSgnPGlucHV0IGNoZWNrZWQ9XCJcIiBkaXNhYmxlZD1cIlwiIHR5cGU9XCJjaGVja2JveFwiPicsICc8aSBjbGFzcz1cImZhIGZhLWNoZWNrLXNxdWFyZVwiPjwvaT4nKTtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGV4dCA9IHRleHRcclxuICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL15cXHMqXFxbIFxcXVxccyovLCAnPGkgY2xhc3M9XCJmYSBmYS1zcXVhcmUtb1wiPjwvaT4gJylcclxuICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL15cXHMqXFxbeFxcXVxccyovLCAnPGkgY2xhc3M9XCJmYSBmYS1jaGVjay1zcXVhcmVcIj48L2k+ICcpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICByZXR1cm4gYDxsaT4ke3RleHR9PC9saT5gO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIHJldHVybiBgPGxpPiR7dGV4dH08L2xpPmA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH07XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgX3VwbG9hZEZpbGVzKGZpbGVzOiBGaWxlTGlzdCk6IHZvaWQge1xyXG4gICAgaWYgKCF0aGlzLl9oYXNVcGxvYWRGdW5jdGlvbiB8fCB0aGlzLmlzVXBsb2FkaW5nKSByZXR1cm47XHJcblxyXG4gICAgaWYgKCFmaWxlcyB8fCBmaWxlcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgdGhpcy5kcmFnb3ZlciA9IGZhbHNlO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5pc1VwbG9hZGluZyA9IHRydWU7XHJcblxyXG4gICAgLy8gZm9yY2UgZHJhZ292ZXIgdG8gYmUgdHJ1ZSwgYXMgVXBsb2FkaW5nIG1hc2sgd29uJ3Qgd29yayBvdGhlcndpc2VcclxuICAgIHRoaXMuZHJhZ292ZXIgPSB0cnVlO1xyXG5cclxuICAgIFByb21pc2UucmVzb2x2ZSgpXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy51cGxvYWQoZmlsZXMpO1xyXG4gICAgICB9KVxyXG4gICAgICAudGhlbihkYXRhID0+IHtcclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSkge1xyXG4gICAgICAgICAgbGV0IG1zZyA9IFtdO1xyXG4gICAgICAgICAgZm9yIChsZXQgaXRlbSBvZiBkYXRhKSB7XHJcbiAgICAgICAgICAgIGxldCB0ZW1wTXNnID0gYFske2l0ZW0ubmFtZX1dKCR7aXRlbS51cmx9KWA7XHJcbiAgICAgICAgICAgIGlmIChpdGVtLmlzSW1nKSB7XHJcbiAgICAgICAgICAgICAgdGVtcE1zZyA9IGAhJHt0ZW1wTXNnfWA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbXNnLnB1c2godGVtcE1zZyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLmluc2VydENvbnRlbnQoJ0N1c3RvbScsIG1zZy5qb2luKCdcXHJcXG4nKSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGNvbnNvbGUud2FybignSW52YWxpZCB1cGxvYWQgcmVzdWx0LiBQbGVhc2UgdXNpbmcgZm9sbG93IHRoaXMgdHlwZSBgVXBsb2FkUmVzdWx0YC4nKVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzVXBsb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5kcmFnb3ZlciA9IGZhbHNlO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyID0+IHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgdGhpcy5pc1VwbG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuZHJhZ292ZXIgPSBmYWxzZTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG59XHJcbiIsIjxkaXYgY2xhc3M9XCJtZC1lZGl0b3ItY29udGFpbmVyXCIgW2NsYXNzLmZvbnQtYXdlc29tZTVdPVwib3B0aW9ucz8udXNpbmdGb250QXdlc29tZTVcIiBbY2xhc3MuZnVsbHNjcmVlbl09XCJpc0Z1bGxTY3JlZW5cIlxyXG4gIFtjbGFzcy5tZC1lZGl0b3ItcmVzaXphYmxlXT1cIm9wdGlvbnM/LnJlc2l6YWJsZVwiIFtzdHlsZS5oZWlnaHRdPVwiaGVpZ2h0XCI+XHJcbiAgPGRpdiBjbGFzcz1cIm1kLWxheW91dFwiPlxyXG4gICAgPGRpdiBjbGFzcz1cInRvb2wtYmFyXCIgKm5nSWY9XCIhaGlkZVRvb2xiYXIgJiYgbW9kZSAhPSAncHJldmlldydcIj5cclxuICAgICAgPGRpdiBjbGFzcz1cImJ0bi1ncm91cFwiPlxyXG4gICAgICAgIDxidXR0b24gY2xhc3M9XCJidG4gYnRuLXNtIGJ0bi1kZWZhdWx0XCIgdHlwZT1cImJ1dHRvblwiIHRpdGxlPVwiQm9sZFwiIChjbGljayk9XCJpbnNlcnRDb250ZW50KCdCb2xkJylcIlxyXG4gICAgICAgICAgKm5nSWY9XCIhaGlkZUljb25zLkJvbGRcIj5cclxuICAgICAgICAgIDxpIGNsYXNzPVwiZmEgZmEtYm9sZFwiPjwvaT5cclxuICAgICAgICA8L2J1dHRvbj5cclxuICAgICAgICA8YnV0dG9uIGNsYXNzPVwiYnRuIGJ0bi1zbSBidG4tZGVmYXVsdFwiIHR5cGU9XCJidXR0b25cIiB0aXRsZT1cIkl0YWxpY1wiIChjbGljayk9XCJpbnNlcnRDb250ZW50KCdJdGFsaWMnKVwiXHJcbiAgICAgICAgICAqbmdJZj1cIiFoaWRlSWNvbnMuSXRhbGljXCI+XHJcbiAgICAgICAgICA8aSBjbGFzcz1cImZhIGZhLWl0YWxpY1wiPjwvaT5cclxuICAgICAgICA8L2J1dHRvbj5cclxuICAgICAgICA8YnV0dG9uIGNsYXNzPVwiYnRuIGJ0bi1zbSBidG4tZGVmYXVsdFwiIHR5cGU9XCJidXR0b25cIiB0aXRsZT1cIkhlYWRpbmdcIiAoY2xpY2spPVwiaW5zZXJ0Q29udGVudCgnSGVhZGluZycpXCJcclxuICAgICAgICAgICpuZ0lmPVwiIWhpZGVJY29ucy5IZWFkaW5nXCI+XHJcbiAgICAgICAgICA8aSBjbGFzcz1cImZhIGZhLWhlYWRlclwiPjwvaT5cclxuICAgICAgICA8L2J1dHRvbj5cclxuICAgICAgICA8YnV0dG9uIGNsYXNzPVwiYnRuIGJ0bi1zbSBidG4tZGVmYXVsdFwiIHR5cGU9XCJidXR0b25cIiB0aXRsZT1cIlJlZmVyZW5jZVwiIChjbGljayk9XCJpbnNlcnRDb250ZW50KCdSZWZlcmVuY2UnKVwiXHJcbiAgICAgICAgICAqbmdJZj1cIiFoaWRlSWNvbnMuUmVmZXJlbmNlXCI+XHJcbiAgICAgICAgICA8aSBjbGFzcz1cImZhIGZhLXF1b3RlLWxlZnRcIj48L2k+XHJcbiAgICAgICAgPC9idXR0b24+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgICA8ZGl2IGNsYXNzPVwiYnRuLWdyb3VwXCI+XHJcbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tc20gYnRuLWRlZmF1bHRcIiB0eXBlPVwiYnV0dG9uXCIgdGl0bGU9XCJMaW5rXCIgKGNsaWNrKT1cImluc2VydENvbnRlbnQoJ0xpbmsnKVwiXHJcbiAgICAgICAgICAqbmdJZj1cIiFoaWRlSWNvbnMuTGlua1wiPlxyXG4gICAgICAgICAgPGkgY2xhc3M9XCJmYSBmYS1saW5rXCI+PC9pPlxyXG4gICAgICAgIDwvYnV0dG9uPlxyXG4gICAgICAgIDxidXR0b24gY2xhc3M9XCJidG4gYnRuLXNtIGJ0bi1kZWZhdWx0XCIgdHlwZT1cImJ1dHRvblwiIHRpdGxlPVwiSW1hZ2VcIiAoY2xpY2spPVwiaW5zZXJ0Q29udGVudCgnSW1hZ2UnKVwiXHJcbiAgICAgICAgICAqbmdJZj1cIiFoaWRlSWNvbnMuSW1hZ2VcIj5cclxuICAgICAgICAgIDxpIGNsYXNzPVwiZmEgZmEtaW1hZ2VcIj48L2k+XHJcbiAgICAgICAgPC9idXR0b24+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgICA8ZGl2IGNsYXNzPVwiYnRuLWdyb3VwXCI+XHJcbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tc20gYnRuLWRlZmF1bHRcIiB0eXBlPVwiYnV0dG9uXCIgdGl0bGU9XCJVbm9yZGVyZWQgTGlzdFwiIChjbGljayk9XCJpbnNlcnRDb250ZW50KCdVbCcpXCJcclxuICAgICAgICAgICpuZ0lmPVwiIWhpZGVJY29ucy5VbFwiPlxyXG4gICAgICAgICAgPGkgY2xhc3M9XCJmYSBmYS1saXN0LXVsXCI+PC9pPlxyXG4gICAgICAgIDwvYnV0dG9uPlxyXG4gICAgICAgIDxidXR0b24gY2xhc3M9XCJidG4gYnRuLXNtIGJ0bi1kZWZhdWx0XCIgdHlwZT1cImJ1dHRvblwiIHRpdGxlPVwiT3JkZXJlZCBMaXN0XCIgKGNsaWNrKT1cImluc2VydENvbnRlbnQoJ09sJylcIlxyXG4gICAgICAgICAgKm5nSWY9XCIhaGlkZUljb25zLk9sXCI+XHJcbiAgICAgICAgICA8aSBjbGFzcz1cImZhIGZhLWxpc3Qtb2xcIj48L2k+XHJcbiAgICAgICAgPC9idXR0b24+XHJcbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tc20gYnRuLWRlZmF1bHRcIiB0eXBlPVwiYnV0dG9uXCIgdGl0bGU9XCJDb2RlIEJsb2NrXCIgKGNsaWNrKT1cImluc2VydENvbnRlbnQoJ0NvZGUnKVwiXHJcbiAgICAgICAgICAqbmdJZj1cIiFoaWRlSWNvbnMuQ29kZVwiPlxyXG4gICAgICAgICAgPGkgY2xhc3M9XCJmYSBmYS1maWxlLWNvZGUtb1wiPjwvaT5cclxuICAgICAgICA8L2J1dHRvbj5cclxuICAgICAgPC9kaXY+XHJcbiAgICAgIDxkaXYgY2xhc3M9XCJidG4tZ3JvdXBcIj5cclxuICAgICAgICA8YnV0dG9uIGNsYXNzPVwiYnRuIGJ0bi1zbSBidG4tZGVmYXVsdFwiIHR5cGU9XCJidXR0b25cIlxyXG4gICAgICAgICAgW2F0dHIudGl0bGVdPVwic2hvd1ByZXZpZXdQYW5lbCA/ICdIaWRlIFByZXZpZXcnIDogJ1Nob3cgUHJldmlldydcIiAoY2xpY2spPVwidG9nZ2xlUHJldmlldygpXCJcclxuICAgICAgICAgICpuZ0lmPVwiIWhpZGVJY29ucy5Ub2dnbGVQcmV2aWV3XCI+XHJcbiAgICAgICAgICA8aSBjbGFzcz1cImZhXCIgW2NsYXNzLmZhLWV5ZV09XCIhc2hvd1ByZXZpZXdQYW5lbFwiIFtjbGFzcy5mYS1leWUtc2xhc2hdPVwic2hvd1ByZXZpZXdQYW5lbFwiPjwvaT5cclxuICAgICAgICA8L2J1dHRvbj5cclxuICAgICAgPC9kaXY+XHJcbiAgICAgIDxkaXYgY2xhc3M9XCJidG4tZ3JvdXAgcHVsbC1yaWdodCBoaWRlLXNwbGl0XCI+XHJcbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tc20gYnRuLWRlZmF1bHRcIiB0eXBlPVwiYnV0dG9uXCIgW2NsYXNzLmFjdGl2ZV09XCJpc0Z1bGxTY3JlZW5cIiAoY2xpY2spPVwiZnVsbFNjcmVlbigpXCJcclxuICAgICAgICAgICpuZ0lmPVwiIWhpZGVJY29ucy5GdWxsU2NyZWVuXCI+XHJcbiAgICAgICAgICA8aSBjbGFzcz1cImZhXCIgW2NsYXNzLmZhLWFycm93cy1hbHRdPVwiIW9wdGlvbnM/LnVzaW5nRm9udEF3ZXNvbWU1IHx8ICFpc0Z1bGxTY3JlZW5cIlxyXG4gICAgICAgICAgICBbY2xhc3MuZmEtY29tcHJlc3NdPVwib3B0aW9ucz8udXNpbmdGb250QXdlc29tZTUgJiYgaXNGdWxsU2NyZWVuXCI+PC9pPlxyXG4gICAgICAgIDwvYnV0dG9uPlxyXG4gICAgICA8L2Rpdj5cclxuICAgIDwvZGl2PlxyXG4gICAgPGRpdiBjbGFzcz1cImVkaXRvci1jb250YWluZXJcIj5cclxuICAgICAgPGRpdiBbY2xhc3MuZHJhZ292ZXJdPVwiZHJhZ292ZXJcIiBbc3R5bGUuZGlzcGxheV09XCJtb2RlID09ICdwcmV2aWV3JyA/ICdub25lJyA6IG51bGxcIlxyXG4gICAgICAgIChkcmFnb3Zlcik9XCJvbkRyYWdvdmVyKCRldmVudClcIj5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwiZHJhZy1jb250YWluZXJcIj5cclxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJ1cGxvYWQtbG9hZGluZ1wiPlxyXG4gICAgICAgICAgICA8aSBjbGFzcz1cImZhIGZhLXVwbG9hZFwiICpuZ0lmPVwiIWlzVXBsb2FkaW5nXCI+PC9pPlxyXG4gICAgICAgICAgICA8aSBjbGFzcz1cImZhIGZhLXNwaW5uZXIgZmEtcHVsc2UgZmEtZndcIiAqbmdJZj1cImlzVXBsb2FkaW5nXCI+PC9pPlxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwidGV4dFwiPnt7IGlzVXBsb2FkaW5nID8gJ1VwbG9hZGluZycgOiAnRHJhZyBpdCBoZXJlJyB9fTwvZGl2PlxyXG4gICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPGRpdiBjbGFzcz1cImRyYWctY29udGFpbmVyIGRyYWctY29udGFpbmVyLW1hc2tcIiAoZHJvcCk9XCJvbkRyb3AoJGV2ZW50KVwiIChkcmFnbGVhdmUpPVwib25EcmFnbGVhdmUoJGV2ZW50KVwiPjwvZGl2PlxyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJlZGl0b3ItcGFuZWxcIiBjb250ZW50ZWRpdGFibGU9XCJ0cnVlXCIgKHBhc3RlKT1cIm9uQWNlRWRpdG9yUGFzdGUoJGV2ZW50KVwiPlxyXG4gICAgICAgICAgPGRpdiBjbGFzcz1cImFjZS1lZGl0b3JcIiAjYWNlRWRpdG9yPjwvZGl2PlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgICA8L2Rpdj5cclxuICAgICAgPGRpdiBjbGFzcz1cInByZXZpZXctY29udGFpbmVyXCIgW3N0eWxlLmRpc3BsYXldPVwiKG1vZGUgPT0gJ3ByZXZpZXcnIHx8IHNob3dQcmV2aWV3UGFuZWwpID8gJ2Jsb2NrJyA6ICdub25lJ1wiXHJcbiAgICAgICAgKGNsaWNrKT1cInByZXZpZXdQYW5lbENsaWNrKCRldmVudClcIj5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwicHJldmlldy1wYW5lbFwiICNwcmV2aWV3Q29udGFpbmVyPjwvZGl2PlxyXG4gICAgICA8L2Rpdj5cclxuICAgIDwvZGl2PlxyXG4gICAgPGRpdiBjbGFzcz1cIm1kLWZvb3RlclwiICpuZ0lmPVwibWF4bGVuZ3RoID4gMCAmJiBtb2RlICE9ICdwcmV2aWV3J1wiPlxyXG4gICAgICA8ZGl2IGNsYXNzPVwidGV4dC1yaWdodCBsZW5ndGgtdmlld1wiPlxyXG4gICAgICAgIHt7IG1hcmtkb3duVmFsdWU/Lmxlbmd0aCB9fSAvIHt7IG1heGxlbmd0aCB9fVxyXG4gICAgICA8L2Rpdj5cclxuICAgICAgPGRpdiBjbGFzcz1cInJlc2l6ZS1idG5cIj48L2Rpdj5cclxuICAgIDwvZGl2PlxyXG4gIDwvZGl2PlxyXG4gIDxtZC1lZGl0b3ItcmVzaXplLXNlbnNvciAqbmdJZj1cIm9wdGlvbnM/LnJlc2l6YWJsZVwiIChyZXNpemUpPVwibWRFZGl0b3JSZXNpemUoJGV2ZW50KVwiPjwvbWQtZWRpdG9yLXJlc2l6ZS1zZW5zb3I+XHJcbjwvZGl2PlxyXG4iXX0=